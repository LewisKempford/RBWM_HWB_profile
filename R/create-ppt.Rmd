---
params:
  save_params_as: "params.Rds"

  # Introduction
  title: TRUE

  # People and place
  title_people_and_place: TRUE
  population: TRUE
  deprivation: TRUE

  # Best start in life
  title_best_start_in_life: TRUE
  child_admissions: TRUE
  injury_admiss_under_5: TRUE
  injury_admiss_under_15: TRUE
  injury_admiss_15_to_24: TRUE
  reception_obesity: TRUE
  reception_overweight: TRUE
  year_6_obesity: TRUE
  year_6_overweight: TRUE
  
  # Living well
  title_living_well: TRUE
  life_expectancy_females: TRUE
  life_expectancy_males: TRUE
  unemployment: TRUE
  long_term_unemployment: TRUE
  emergency_admiss_all: TRUE
  emergency_admiss_chd: TRUE
  emergency_admiss_stroke: TRUE
  emergency_admiss_heart_attack: TRUE
  emergency_admiss_copd: TRUE
  emergency_admiss_self_harm: TRUE
  
  # Healthy ageing
  title_health_ageing: TRUE
  emergency_admiss_hip_fracture: TRUE
  deaths_all_causes: TRUE
  deaths_under_75: TRUE
  deaths_preventable: TRUE
  deaths_cancer: TRUE
  deaths_cancer_under_75: TRUE
  deaths_circulatory_disease: TRUE
  deaths_circulatory_disease_under_75: TRUE
  deaths_chd: TRUE
  deaths_stroke: TRUE
  deaths_respiratory: TRUE
  
  # Healthy places
  title_healthy_place: TRUE
---

```{r settings}

# set working directory
setwd(paste0("C:/Users/", Sys.getenv("username"), "/OneDrive - Royal Borough of Windsor and Maidenhead/projects_git/JHWBS-profiles/R"))

# Save dataset
save_dataset <- TRUE

# Do you want to load the lookup and data files
load_files <- TRUE

ward_name <- NULL
ward_code <- NULL

# Version number
version_num <- 0.29

# Load required packages
library(officer)
library(phiTools)
library(sf)

# Warning options
options(warn = 1) ## Show warnings as they occur, useful for finding and dealing with them.
options(scipen = 999) # Turn scientific notion off

# System time
t1 <- Sys.time()

# ---- PowerPoint template ----

# Open connection to pptx file
mydoc <- read_pptx(path = paste0("C:/Users/", Sys.getenv("username"), "/OneDrive - Royal Borough of Windsor and Maidenhead/PHI - Data and Analytics/References/Templates/RBWM-PHI-profiles-template.pptx"))

# slide number
slide_num <- 0

## Save the parameters in case we want to use them in a script
save_params_as <- params$save_params_as
saveRDS(params, file = save_params_as)

report_params <- params

## Choose which slides to include

# Introduction
incl_title <- report_params$title

# People and place
incl_title_people_and_place<- report_params$title_people_and_place
incl_population <- report_params$population
incl_deprivation <- report_params$deprivation

# Best start in life
incl_title_best_start_in_life <- report_params$title_best_start_in_life
incl_child_admissions <- report_params$child_admissions
incl_injury_admiss_under_5 <- report_params$injury_admiss_under_5
incl_injury_admiss_under_15 <- report_params$injury_admiss_under_15
incl_injury_admiss_15_to_24 <- report_params$injury_admiss_15_to_24
incl_reception_obesity <- report_params$reception_obesity
incl_reception_overweight <- report_params$reception_overweight
incl_year_6_obesity <- report_params$year_6_obesity
incl_year_6_overweight <- report_params$year_6_overweight

# Living well
incl_title_living_well <- report_params$title_living_well
incl_life_expectancy_females <- report_params$life_expectancy_females
incl_life_expectancy_males <- report_params$life_expectancy_males
incl_unemployment <- report_params$unemployment
incl_long_term_unemployment <- report_params$long_term_unemployment
incl_emergency_admiss_all <- report_params$emergency_admiss_all
incl_emergency_admiss_chd <- report_params$emergency_admiss_chd
incl_emergency_admiss_stroke <- report_params$emergency_admiss_stroke
incl_emergency_admiss_heart_attack <- report_params$emergency_admiss_heart_attack
incl_emergency_admiss_copd <- report_params$emergency_admiss_copd
incl_emergency_admiss_self_harm <- report_params$emergency_admiss_self_harm

# Healthy ageing
incl_title_health_ageing <- report_params$title_health_ageing
incl_emergency_admiss_hip_fracture <- report_params$emergency_admiss_hip_fracture
incl_deaths_all_causes <- report_params$deaths_all_causes
incl_deaths_under_75 <- report_params$deaths_under_75
incl_deaths_preventable <- report_params$deaths_preventable
incl_deaths_cancer <- report_params$deaths_cancer
incl_deaths_cancer_under_75 <- report_params$deaths_cancer_under_75
incl_deaths_circulatory_disease <- report_params$deaths_circulatory_disease
incl_deaths_circulatory_disease_under_75 <- report_params$deaths_circulatory_disease_under_75
incl_deaths_chd <- report_params$deaths_chd
incl_deaths_stroke <- report_params$deaths_stroke
incl_deaths_respiratory <- report_params$deaths_respiratory

# Healthy place
incl_title_healthy_place <- report_params$title_healthy_place


# Create empty data frame for summary table
summary <- data.frame(indicator = character(), 
                      comparison = character(), 
                      slide = numeric(), stringsAsFactors = FALSE) 

# Create empty data frame for dataset
dataset <- data.frame()

#---- Data ----
rbwm_code <- "E06000040"

# england and wales LSOA to ward to lad
lsoa_ward_lad <- read.csv(paste0("C:/Users/", Sys.getenv("username"), "/OneDrive - Royal Borough of Windsor and Maidenhead/PHI - Data and Analytics/References/Geography/ONS Open Geography Portal/Lookups/LSOA to Ward to LAD/LSOA_(2021)_to_Electoral_Ward_(2024)_to_LAD_(2024)_Best_Fit_Lookup_in_EW.csv"))

# RBWM lsoas
i <- lsoa_ward_lad$LAD24CD == rbwm_code
rbwm_lsoas <- lsoa_ward_lad$LSOA21CD[i]

# England and Wales MSOA to ward to LAD
msoa_ward_lad <- read.csv(paste0("C:/Users/", Sys.getenv("username"), "/OneDrive - Royal Borough of Windsor and Maidenhead/PHI - Data and Analytics/References/Geography/ONS Open Geography Portal/Lookups/MSOA to Ward to LAD/MSOA_(2021)_to_Ward_(2024)_to_LAD_(2024)_Best_Fit_Lookup_in_EW.csv"))

# RBWM MSOAs
i <- msoa_ward_lad$LAD24CD == rbwm_code
rbwm_msoas <- msoa_ward_lad$MSOA21CD[i]

# ONS LA pop estimates
pop_la <- readRDS(paste0("C:/Users/", Sys.getenv("username"), "/OneDrive - Royal Borough of Windsor and Maidenhead/PHI - Data and Analytics/Datasets/ONS/nomis/Population/Population estimates/Local authority/processed data/ons-la-pop.Rds"))

# ONS lsoa pop estimates
pop_lsoa <- readRDS(paste0("C:/Users/", Sys.getenv("username"), "/OneDrive - Royal Borough of Windsor and Maidenhead/PHI - Data and Analytics/Datasets/ONS/nomis/Population/Population estimates/lsoa/processed data/ons-lsoa-pop.Rds"))

# LSOA deprivation
dep <- data_deprivation_pop(population = pop_lsoa)

#### Fingertips data ####
fingertips_msoa <- data_fingertips_msoa()

#---- Shape files ----
#### RBWM LSOAs ####
shp_lsoa <- data_shape_lsoa()

#### MSOAs ####
shp_msoa <- data_shape_msoa()

```

```{r title, eval = incl_title}

slide_num <- slide_num + 1

# Add slide
mydoc <- add_slide(mydoc, layout = "title logo", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = paste0("The Royal Borough of Windsor \u0026 Maidenhead Health and Wellbeing profile"))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "subtitle"),
                 value = paste0("Public Health ", format(Sys.Date(), "%d/%m/%Y")))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
  
```

```{r title_people_and_place, eval = incl_title_people_and_place}

# ---- People and place ----
slide_num <- slide_num + 1
theme <- NULL
title <- paste0("People and place")
short_title <- NULL


# Add slide
mydoc <- add_slide(mydoc, layout = "title", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
  
```

```{r population, eval = incl_population}

slide_num <- slide_num + 1
theme <- NULL
title <- paste0("Population")
short_title <- NULL

# Outputs
pop_pyramid <- plot_pop_pyramid(data = pop_la)
pop_comp <- plot_pop_area_comp_eng(data = pop_la)

# Add slide
mydoc <- add_slide(mydoc, layout = "two content", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "content left"), 
                 value = pop_pyramid$plot, alt_text = pop_pyramid$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "content right"), 
                 value = pop_comp$plot, alt_text = pop_comp$alt_text)

```

```{r deprivation, eval = incl_deprivation}

slide_num <- slide_num + 1
theme <- NULL
title <- paste0("Deprivation")
short_title <- NULL

# Outputs
pop_dep_bar_plot <- plot_dep_pop(data = dep)
dep_map <- map_deprivation(deprivation_data = dep, lsoa_shape = shp_lsoa,
                           lsoas_to_plot = rbwm_lsoas)

# Add slide
mydoc <- add_slide(mydoc, layout = "two content", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "content left"), 
                 value = pop_dep_bar_plot$plot, alt_text = pop_dep_bar_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "content right"), 
                 value = dep_map$ggplot, alt_text = dep_map$alt_text)

```

```{r title_best_start_in_life, eval = incl_title_best_start_in_life}

# ---- Best start in life ----
slide_num <- slide_num + 1
theme <- NULL
title <- paste0("Best start in life")
short_title <- NULL


# Add slide
mydoc <- add_slide(mydoc, layout = "title", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
  
```

```{r child_admissions, eval = incl_child_admissions}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93115
ind_sex <- "Persons"
ind_age <- "Under 5 yrs"
title <- paste0("Emergency hospital admissions in under 5 years old, ", tolower(ind_sex), ", ", tolower(ind_age))
short_title <- paste0("Emergency hospital admissions (", ind_age, ")")
additional_text <- NULL
notes <- NULL

value_type <- "Crude rate per 1,000"
value_type_short <- "per 1,000"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Byar's method method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r injury_admiss_under_5, eval = incl_injury_admiss_under_5}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93114
ind_sex <- "Persons"
ind_age <- "Under 5 yrs"
title <- paste0("Emergency hospital admissions for injuries, ",
                tolower(ind_sex), ", ", tolower(ind_age))
short_title <- paste0("Emergency admissions for injuries (", ind_age, ")")
additional_text <- NULL
notes <- NULL

value_type <- "Crude rate per 1,000"
value_type_short <- "per 1,000"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Byar's method method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r injury_admiss_under_15, eval = incl_injury_admiss_under_15}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93219
ind_sex <- "Persons"
ind_age <- "Under 15 yrs"
title <- paste0("Emergency hospital admissions for injuries, ", 
                tolower(ind_sex), ", ", tolower(ind_age))
short_title <- paste0("Emergency admissions for injuries (", ind_age, ")")
additional_text <- NULL
notes <- NULL

value_type <- "Crude rate per 1,000"
value_type_short <- "per 1,000"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Byar's method method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r injury_admiss_15_to_24, eval = incl_injury_admiss_15_to_24}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93224
ind_sex <- "Persons"
ind_age <- "15 to 24 yrs"
title <- paste0("Emergency hospital admissions for injuries, ", 
                tolower(ind_sex), ", ", tolower(ind_age))
short_title <- paste0("Emergency admissions for injuries (", ind_age, ")")
additional_text <- NULL
notes <- NULL

value_type <- "Crude rate per 1,000"
value_type_short <- "per 1,000"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Byar's method method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r reception_obesity, eval = incl_reception_obesity}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93105
ind_sex <- "Persons"
ind_age <- "4-5 yrs"
title <- paste0("Reception: Prevalence of obesity, ", tolower(ind_sex), ", ", tolower(ind_age))
short_title <- paste0("Reception: Prevalence of obesity (", ind_age, ")")
additional_text <- "Obesity: including severe obesity.\n\n"
notes <- "\nNotes: Due to the impact of COVID-19 on the NCMP data collection, data was not published for the 2018/19-20/21 time period."

value_type <- "Proportion (%)"
value_type_short <- "%"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Wilson Score CI method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = "Proportion (%)")
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r reception_overweight, eval = incl_reception_overweight}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93106
ind_sex <- "Persons"
ind_age <- "4-5 yrs"
title <- paste0("Reception: Prevalence of overweight, ", tolower(ind_sex), ", ", tolower(ind_age))
short_title <- paste0("Reception: Prevalence of overweight (", ind_age, ")")
additional_text <- "Overweight: including obesity\n\n"
notes <- "\nNotes: Due to the impact of COVID-19 on the NCMP data collection, data was not published for the 2018/19-20/21 time period."

value_type <- "Proportion (%)"
value_type_short <- "%"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Wilson Score CI method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = "Proportion (%)")
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r year_6_obesity, eval = incl_year_6_obesity}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93107
ind_sex <- "Persons"
ind_age <- "10-11 yrs"
title <- paste0("Year 6: Prevalence of obesity, ", tolower(ind_sex), ", ", tolower(ind_age))
short_title <- paste0("Year 6: Prevalence of obesity (", ind_age, ")")
additional_text <- "Obesity: including severe obesity.\n\n"
notes <- "\nNotes: Due to the impact of COVID-19 on the NCMP data collection, data was not published for the 2018/19-20/21 time period."

value_type <- "Proportion (%)"
value_type_short <- "%"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Wilson Score CI method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = "Proportion (%)")
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r year_6_overweight, eval = incl_year_6_overweight}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93108
ind_sex <- "Persons"
ind_age <- "10-11 yrs"
title <- paste0("Year 6: Prevalence of overweight, ", tolower(ind_sex), ", ", tolower(ind_age))
short_title <- paste0("Year 6: Prevalence of overweight (", ind_age, ")")
additional_text <- "Overweight: including obesity.\n\n"
notes <- "\nNotes: Due to the impact of COVID-19 on the NCMP data collection, data was not published for the 2018/19-20/21 time period."

value_type <- "Proportion (%)"
value_type_short <- "%"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Wilson Score CI method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = "Proportion (%)")
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r title_living_well, eval = incl_title_living_well}

# ---- Living well ----
slide_num <- slide_num + 1
theme <- NULL
title <- paste0("Living well")
short_title <- NULL


# Add slide
mydoc <- add_slide(mydoc, layout = "title", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
  
```

```{r life_expectancy_females, eval = incl_life_expectancy_females}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93283
ind_sex <- "Female"
ind_age <- NULL
title <- paste0("Life expectancy at birth, upper age band 90 and over (",
                tolower(ind_sex), ")")
short_title <- paste0("Life expectancy at birth (", ind_sex, ")")
additional_text <- NULL
notes <- NULL

value_type <- "Life expetancy (years)"
value_type_short <- "Years"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Chiang CL (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID & 
                       fingertips_msoa$Sex == ind_sex, ]
x <- create_comp_rag(data = x, low_is_good = FALSE)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = timeperiod)
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r life_expectancy_males, eval = incl_life_expectancy_males}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93283
ind_sex <- "Male"
ind_age <- NULL
title <- paste0("Life expectancy at birth, upper age band 90 and over (",
                tolower(ind_sex), ")")
short_title <- paste0("Life expectancy at birth (", ind_sex, ")")
additional_text <- NULL
notes <- NULL

value_type <- "Life expetancy (years)"
value_type_short <- "Years"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Chiang CL (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID & 
                       fingertips_msoa$Sex == ind_sex, ]
x <- create_comp_rag(data = x, low_is_good = FALSE)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = timeperiod)
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r unemployment, eval = incl_unemployment}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93097
ind_sex <- "Persons"
ind_age <- "16-64 yrs"
title <- paste0("Unemployment (Percentage of the working age population claiming out of work benefit) (", tolower(ind_sex), "), (", tolower(ind_age), ")")
short_title <- paste0("Unemployment (", ind_age, ")")
additional_text <- NULL
notes <- NULL

value_type <- "Proportion (%)"
value_type_short <- "%"
timeperiod <- "financial years"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Wilson Score CI method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = timeperiod)
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r long_term_unemployment, eval = incl_long_term_unemployment}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93098
ind_sex <- "Persons"
ind_age <- "16-64 yrs"
title <- paste0("Long-Term Unemployment (", tolower(ind_sex), "), (", tolower(ind_age), ")")
short_title <- paste0("Long-Term Unemployment (", ind_age, ")")
additional_text <- NULL
notes <- NULL

value_type <- "Crude rate per 1,000"
value_type_short <- "per 1,000"
timeperiod <- "financial years"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Byar's method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = timeperiod)
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r emergency_admiss_all, eval = incl_emergency_admiss_all}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93227
ind_sex <- "Persons"
ind_age <- "All ages"
title <- paste0("Emergency hospital admissions for all causes, ",
                tolower(ind_sex), ", ", tolower(ind_age))
short_title <- paste0("Emergency admissions for all causes")
additional_text <- NULL
notes <- NULL

value_type <- "Indirectly standardised ratio"
value_type_short <- "per 100"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Byar's method method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r emergency_admiss_chd, eval = incl_emergency_admiss_chd}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93229
ind_sex <- "Persons"
ind_age <- "All ages"
title <- paste0("EEmergency hospital admissions for coronary heart disease, ",
                tolower(ind_sex), ", ", tolower(ind_age))
short_title <- paste0("Emergency admissions for CHD")
additional_text <- NULL
notes <- NULL

value_type <- "Indirectly standardised ratio"
value_type_short <- "per 100"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Byar's method method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r emergency_admiss_stroke, eval = incl_emergency_admiss_stroke}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93231
ind_sex <- "Persons"
ind_age <- "All ages"
title <- paste0("Emergency hospital admissions for stroke, ",
                tolower(ind_sex), ", ", tolower(ind_age))
short_title <- paste0("Emergency admissions for stroke")
additional_text <- NULL
notes <- NULL

value_type <- "Indirectly standardised ratio"
value_type_short <- "per 100"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Byar's method method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r emergency_admiss_heart_attack, eval = incl_emergency_admiss_heart_attack}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93232
ind_sex <- "Persons"
ind_age <- "All ages"
title <- paste0("Emergency hospital admissions for myocardial infarction (heart attack), ",
                tolower(ind_sex), ", ", tolower(ind_age))
short_title <- paste0("Emergency admissions for heart attack")
additional_text <- NULL
notes <- NULL

value_type <- "Indirectly standardised ratio"
value_type_short <- "per 100"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Byar's method method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r emergency_admiss_copd, eval = incl_emergency_admiss_copd}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93233
ind_sex <- "Persons"
ind_age <- "All ages"
title <- paste0("Emergency hospital admissions for chronic obstructive pulmonary disease (COPD), ",
                tolower(ind_sex), ", ", tolower(ind_age))
short_title <- paste0("Emergency admissions for COPD")
additional_text <- NULL
notes <- NULL

value_type <- "Indirectly standardised ratio"
value_type_short <- "per 100"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Byar's method method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r emergency_admiss_self_harm, eval = incl_emergency_admiss_self_harm}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93239
ind_sex <- "Persons"
ind_age <- "All ages"
title <- paste0("Emergency hospital admissions for intentional self harm, ",
                tolower(ind_sex), ", ", tolower(ind_age))
short_title <- paste0("Emergency admissions for self harm")
additional_text <- NULL
notes <- NULL

value_type <- "Indirectly standardised ratio"
value_type_short <- "per 100"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Byar's method method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r title_health_ageing, eval = incl_title_health_ageing}

# ---- Healthy ageing ----
slide_num <- slide_num + 1
theme <- NULL
title <- paste0("Healthy ageing")
short_title <- NULL


# Add slide
mydoc <- add_slide(mydoc, layout = "title", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
  
```

```{r emergency_admiss_hip_fracture, eval = incl_emergency_admiss_hip_fracture}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93241
ind_sex <- "Persons"
ind_age <- "65 yrs+"
title <- paste0("Emergency hospital admissions for hip fracture, ",
                tolower(ind_sex), ", ", tolower(ind_age))
short_title <- paste0("Emergency admissions for hip fracture (", ind_age, ")")
additional_text <- NULL
notes <- NULL

value_type <- "Indirectly standardised ratio"
value_type_short <- "per 100"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Byar's method method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r deaths_all_causes, eval = incl_deaths_all_causes}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93250
ind_sex <- "Persons"
ind_age <- "All ages"
title <- paste0("Deaths from all causes, ", tolower(ind_sex), ", ",
                tolower(ind_age))
short_title <- paste0("Deaths from all causes")
additional_text <- NULL
notes <- NULL

value_type <- "Indirectly standardised ratio"
value_type_short <- "per 100"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Byar's method method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r deaths_under_75, eval = incl_deaths_under_75}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93252
ind_sex <- "Persons"
ind_age <- "Under 75 yrs"
title <- paste0("Deaths from all causes, ", tolower(ind_sex), ", ",
                tolower(ind_age))
short_title <- paste0("Deaths from all causes (", ind_age, ")")
additional_text <- NULL
notes <- NULL

value_type <- "Indirectly standardised ratio"
value_type_short <- "per 100"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Byar's method method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r deaths_preventable, eval = incl_deaths_preventable}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93480
ind_sex <- "Persons"
ind_age <- "Under 75 yrs"
title <- paste0("Deaths from causes considered preventable, ", tolower(ind_sex), ", ",
                tolower(ind_age))
short_title <- paste0("Deaths from preventable causes (", ind_age, ")")
additional_text <- NULL
notes <- NULL

value_type <- "Indirectly standardised ratio"
value_type_short <- "per 100"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Byar's method method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r deaths_cancer, eval = incl_deaths_cancer}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93253
ind_sex <- "Persons"
ind_age <- "All ages"
title <- paste0("Deaths from all cancer, ", tolower(ind_sex), ", ",
                tolower(ind_age))
short_title <- paste0("Deaths from all cancer")
additional_text <- NULL
notes <- NULL

value_type <- "Indirectly standardised ratio"
value_type_short <- "per 100"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Byar's method method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r deaths_cancer_under_75, eval = incl_deaths_cancer_under_75}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93254
ind_sex <- "Persons"
ind_age <- "Under 75 yrs"
title <- paste0("Deaths from all cancer, ", tolower(ind_sex), ", ",
                tolower(ind_age))
short_title <- paste0("Deaths from all cancer (", ind_age, ")")
additional_text <- NULL
notes <- NULL

value_type <- "Indirectly standardised ratio"
value_type_short <- "per 100"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Byar's method method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r deaths_circulatory_disease, eval = incl_deaths_circulatory_disease}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93255
ind_sex <- "Persons"
ind_age <- "All ages"
title <- paste0("Deaths from circulatory disease, ", tolower(ind_sex), ", ",
                tolower(ind_age))
short_title <- paste0("Deaths from circulatory disease")
additional_text <- NULL
notes <- NULL

value_type <- "Indirectly standardised ratio"
value_type_short <- "per 100"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Byar's method method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r deaths_circulatory_disease_under_75, eval = incl_deaths_circulatory_disease_under_75}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93256
ind_sex <- "Persons"
ind_age <- "Under 75 yrs"
title <- paste0("Deaths from circulatory disease, ", tolower(ind_sex), ", ",
                tolower(ind_age))
short_title <- paste0("Deaths from circulatory disease (", ind_age, ")")
additional_text <- NULL
notes <- NULL

value_type <- "Indirectly standardised ratio"
value_type_short <- "per 100"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Byar's method method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r deaths_chd, eval = incl_deaths_chd}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93257
ind_sex <- "Persons"
ind_age <- "All ages"
title <- paste0("Deaths from coronary heart disease, ", tolower(ind_sex), ", ",
                tolower(ind_age))
short_title <- paste0("Deaths from CHD")
additional_text <- NULL
notes <- NULL

value_type <- "Indirectly standardised ratio"
value_type_short <- "per 100"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Byar's method method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r deaths_stroke, eval = incl_deaths_stroke}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93259
ind_sex <- "Persons"
ind_age <- "All ages"
title <- paste0("Deaths from stroke, ", tolower(ind_sex), ", ",
                tolower(ind_age))
short_title <- paste0("Deaths from stroke")
additional_text <- NULL
notes <- NULL

value_type <- "Indirectly standardised ratio"
value_type_short <- "per 100"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Byar's method method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r deaths_respiratory, eval = incl_deaths_respiratory}

slide_num <- slide_num + 1
theme <- NULL

# Metadata
ind_ID <- 93260
ind_sex <- "Persons"
ind_age <- "All ages"
title <- paste0("Deaths from respiratory diseases, ", tolower(ind_sex), ", ",
                tolower(ind_age))
short_title <- paste0("Deaths from respiratory diseases")
additional_text <- NULL
notes <- NULL

value_type <- "Indirectly standardised ratio"
value_type_short <- "per 100"
timeperiod <- "periods"
original_geography <- "MSOA"
CI_level <- 0.95
confidence_interval_method <- paste0("Byar's method method (", CI_level * 100,"%)")
source <- paste0("Office for Health Improvement and Disparities. Fingertips. Indicator ID: ", ind_ID)

x <- fingertips_msoa[fingertips_msoa$IndicatorID == ind_ID, ]
x <- create_comp_rag(data = x)

latest_value <- plot_latest_value(data = x, value_type = value_type)
latest_period <- paste0("Latest time period: ", max(x$Timeperiod))
trend_plot <- plot_indicator_trend(data = x, value_type = value_type, 
                                   show_comp_legend = FALSE, 
                                   timeperiod_format = "periods")
area_comp <- plot_area_comparison(data = x, value_type = value_type,
                                  show_legend = FALSE)
map <- map_rag_indicator(data = x, shape_file = shp_msoa, 
                         areas_to_map = rbwm_msoas)

metadata <- text_metadata(value_type = value_type, 
                          original_geography = original_geography, 
                          ci_method = confidence_interval_method,
                          source = source)

# add indicator to master dataset
dataset <- rbind(dataset, x)

# Add slide
mydoc <- add_slide(mydoc, layout = "jlhws", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = short_title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "overview"), 
                 value = latest_value$plot, alt_text = latest_value$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "latest period"), 
                 value = latest_period, alt_text = latest_period)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "trend"), 
                 value = trend_plot$plot, alt_text = trend_plot$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "compare areas"), 
                 value = area_comp$plot, alt_text = area_comp$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "map"), 
                 value = map$plot, alt_text = map$alt_text)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "metadata"), 
                 value = metadata) 

```

```{r title_healthy_place, eval = incl_title_healthy_place}

# ---- Healthy ageing ----
slide_num <- slide_num + 1
theme <- NULL
title <- paste0("Healthy place")
short_title <- NULL


# Add slide
mydoc <- add_slide(mydoc, layout = "title", master = "PHI profiles")
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "title"),
                 value = title)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "slide number"), 
                 value = slide_num)
mydoc <- ph_with(mydoc, location = ph_location_label(ph_label = "version"), 
                 value = paste0("Version ", format(version_num, nsmall = 1)))
  
```

``` {r finish.code}

outfile <- paste0("../output/RBWM-HWB-profile-", format(version_num, nsmall = 1), ".pptx")
print(mydoc, target = outfile)

# Save dataset
if(save_dataset == TRUE){
  saveRDS(dataset, paste0("C:/Users/", Sys.getenv("username"), "/OneDrive - Royal Borough of Windsor and Maidenhead/PHI - Data and Analytics/Datasets/Profiles/JHWBS profile/RBWM-JWHBS-data-", format(version_num, nsmall = 1),".Rds"))
}

t2 <- Sys.time()
duration <- difftime(t2, t1, units = "secs")
# status.log(paste("This took", duration, "seconds"))

```
